<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="python," />










<meta name="description" content="来源 http:&#x2F;&#x2F;blog.jobbole.com&#x2F;65218&#x2F; 使用场景 https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;collections.html#module-collections 数据结构数据结构的概念很好理解，就是用来将数据组织在一起的结构。换句话说，数据结构是用来存储一系列关联数据的东西。在Python中有四种内建的数据结构，分别是List、Tuple、D">
<meta name="keywords" content="python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python中的高级数据结构">
<meta property="og:url" content="http:&#x2F;&#x2F;kanatsux.github.io&#x2F;2019&#x2F;12&#x2F;01&#x2F;Python%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84&#x2F;index.html">
<meta property="og:site_name" content="打怪升级的司图">
<meta property="og:description" content="来源 http:&#x2F;&#x2F;blog.jobbole.com&#x2F;65218&#x2F; 使用场景 https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;collections.html#module-collections 数据结构数据结构的概念很好理解，就是用来将数据组织在一起的结构。换句话说，数据结构是用来存储一系列关联数据的东西。在Python中有四种内建的数据结构，分别是List、Tuple、D">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-02-22T16:24:50.049Z">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kanatsux.github.io/2019/12/01/Python中的高级数据结构/"/>





  <title>Python中的高级数据结构 | 打怪升级的司图</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">打怪升级的司图</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">咸鱼夏夏的进阶之路</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kanatsux.github.io/2019/12/01/Python%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="司图">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="打怪升级的司图">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python中的高级数据结构</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-01T16:30:20+08:00">
                2019-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>来源</strong></p>
<p><a href="http://blog.jobbole.com/65218/" target="_blank" rel="noopener">http://blog.jobbole.com/65218/</a></p>
<p><strong>使用场景</strong></p>
<p><a href="https://docs.python.org/3/library/collections.html#module-collections" target="_blank" rel="noopener">https://docs.python.org/3/library/collections.html#module-collections</a></p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>数据结构的概念很好理解，就是用来将数据组织在一起的结构。换句话说，数据结构是用来存储一系列关联数据的东西。在Python中有四种内建的数据结构，分别是List、Tuple、Dictionary以及Set。大部分的应用程序不需要其他类型的数据结构，但若是真需要也有很多高级数据结构可供选择，例如Collection、Array、Heapq、Bisect、Weakref、Copy以及Pprint。本文将介绍这些数据结构的用法，看看它们是如何帮助我们的应用程序的。</p>
<p>关于四种内建数据结构的使用方法很简单，并且网上有很多参考资料，因此本文将不会讨论它们。</p>
<h3 id="1-Collections"><a href="#1-Collections" class="headerlink" title="1. Collections"></a>1. Collections</h3><p>collections模块包含了内建类型之外的一些有用的工具，例如Counter、defaultdict、OrderedDict、deque以及nametuple。其中Counter、deque以及defaultdict是最常用的类。</p>
<h4 id="1-1-Counter"><a href="#1-1-Counter" class="headerlink" title="1.1 Counter()"></a>1.1 Counter()</h4><p>如果你想统计一个单词在给定的序列中一共出现了多少次，诸如此类的操作就可以用到Counter。来看看如何统计一个list中出现的item次数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">li = [<span class="string">"Dog"</span>, <span class="string">"Cat"</span>, <span class="string">"Mouse"</span>, <span class="number">42</span>, <span class="string">"Dog"</span>, <span class="number">42</span>, <span class="string">"Cat"</span>, <span class="string">"Dog"</span>]</span><br><span class="line">a = Counter(li)</span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># Counter(&#123;'Dog': 3, 42: 2, 'Cat': 2, 'Mouse': 1&#125;)</span></span><br></pre></td></tr></table></figure>

<p>若要统计一个list中不同单词的数目，可以这么用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">li = [<span class="string">"Dog"</span>, <span class="string">"Cat"</span>, <span class="string">"Mouse"</span>, <span class="number">42</span>, <span class="string">"Dog"</span>, <span class="number">42</span>, <span class="string">"Cat"</span>, <span class="string">"Dog"</span>]</span><br><span class="line">a = Counter(li)</span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># Counter(&#123;'Dog': 3, 42: 2, 'Cat': 2, 'Mouse': 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> len(set(li)) <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>

<p>如果需要对结果进行分组，可以这么做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">li = [<span class="string">"Dog"</span>, <span class="string">"Cat"</span>, <span class="string">"Mouse"</span>,<span class="string">"Dog"</span>,<span class="string">"Cat"</span>, <span class="string">"Dog"</span>]</span><br><span class="line">a = Counter(li)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># Counter(&#123;'Dog': 3, 'Cat': 2, 'Mouse': 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"&#123;0&#125; : &#123;1&#125;"</span>.format(a.values(),a.keys())  <span class="comment"># [1, 3, 2] : ['Mouse', 'Dog', 'Cat']</span></span><br><span class="line"></span><br><span class="line">print(a.most_common(<span class="number">3</span>)) <span class="comment"># [('Dog', 3), ('Cat', 2), ('Mouse', 1)]</span></span><br></pre></td></tr></table></figure>

<p>以下的代码片段找出一个字符串中出现频率最高的单词，并打印其出现次数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">string = <span class="string">"""   Lorem ipsum dolor sit amet, consectetur</span></span><br><span class="line"><span class="string">    adipiscing elit. Nunc ut elit id mi ultricies</span></span><br><span class="line"><span class="string">    adipiscing. Nulla facilisi. Praesent pulvinar,</span></span><br><span class="line"><span class="string">    sapien vel feugiat vestibulum, nulla dui pretium orci,</span></span><br><span class="line"><span class="string">    non ultricies elit lacus quis ante. Lorem ipsum dolor</span></span><br><span class="line"><span class="string">    sit amet, consectetur adipiscing elit. Aliquam</span></span><br><span class="line"><span class="string">    pretium ullamcorper urna quis iaculis. Etiam ac massa</span></span><br><span class="line"><span class="string">    sed turpis tempor luctus. Curabitur sed nibh eu elit</span></span><br><span class="line"><span class="string">    mollis congue. Praesent ipsum diam, consectetur vitae</span></span><br><span class="line"><span class="string">    ornare a, aliquam a nunc. In id magna pellentesque</span></span><br><span class="line"><span class="string">    tellus posuere adipiscing. Sed non mi metus, at lacinia</span></span><br><span class="line"><span class="string">    augue. Sed magna nisi, ornare in mollis in, mollis</span></span><br><span class="line"><span class="string">    sed nunc. Etiam at justo in leo congue mollis.</span></span><br><span class="line"><span class="string">    Nullam in neque eget metus hendrerit scelerisque</span></span><br><span class="line"><span class="string">    eu non enim. Ut malesuada lacus eu nulla bibendum</span></span><br><span class="line"><span class="string">    id euismod urna sodales.  """</span></span><br><span class="line"></span><br><span class="line">words = re.findall(<span class="string">r'\w+'</span>, string) <span class="comment">#This finds words in the document</span></span><br><span class="line"></span><br><span class="line">lower_words = [word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> words] <span class="comment">#lower all the words</span></span><br><span class="line"></span><br><span class="line">word_counts = Counter(lower_words) <span class="comment">#counts the number each time a word appears</span></span><br><span class="line"><span class="keyword">print</span> word_counts</span><br><span class="line"></span><br><span class="line"><span class="comment"># Counter(&#123;'elit': 5, 'sed': 5, 'in': 5, 'adipiscing': 4, 'mollis': 4, 'eu': 3, </span></span><br><span class="line"><span class="comment"># 'id': 3, 'nunc': 3, 'consectetur': 3, 'non': 3, 'ipsum': 3, 'nulla': 3, 'pretium':</span></span><br><span class="line"><span class="comment"># 2, 'lacus': 2, 'ornare': 2, 'at': 2, 'praesent': 2, 'quis': 2, 'sit': 2, 'congue': 2, 'amet': 2, </span></span><br><span class="line"><span class="comment"># 'etiam': 2, 'urna': 2, 'a': 2, 'magna': 2, 'lorem': 2, 'aliquam': 2, 'ut': 2, 'ultricies': 2, 'mi': 2, </span></span><br><span class="line"><span class="comment"># 'dolor': 2, 'metus': 2, 'ac': 1, 'bibendum': 1, 'posuere': 1, 'enim': 1, 'ante': 1, 'sodales': 1, 'tellus': 1,</span></span><br><span class="line"><span class="comment"># 'vitae': 1, 'dui': 1, 'diam': 1, 'pellentesque': 1, 'massa': 1, 'vel': 1, 'nullam': 1, 'feugiat': 1, 'luctus': 1, </span></span><br><span class="line"><span class="comment"># 'pulvinar': 1, 'iaculis': 1, 'hendrerit': 1, 'orci': 1, 'turpis': 1, 'nibh': 1, 'scelerisque': 1, 'ullamcorper': 1,</span></span><br><span class="line"><span class="comment"># 'eget': 1, 'neque': 1, 'euismod': 1, 'curabitur': 1, 'leo': 1, 'sapien': 1, 'facilisi': 1, 'vestibulum': 1, 'nisi': 1, </span></span><br><span class="line"><span class="comment"># 'justo': 1, 'augue': 1, 'tempor': 1, 'lacinia': 1, 'malesuada': 1&#125;)</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-Deque"><a href="#1-2-Deque" class="headerlink" title="1.2 Deque"></a>1.2 Deque</h4><p>Deque是一种由队列结构扩展而来的双端队列(double-ended queue)，队列元素能够在队列两端添加或删除。因此它还被称为头尾连接列表(head-tail linked list)，尽管叫这个名字的还有另一个特殊的数据结构实现。</p>
<p>Deque支持线程安全的，经过优化的append和pop操作，在队列两端的相关操作都能够达到近乎O(1)的时间复杂度。虽然list也支持类似的操作，但是它是对定长列表的操作表现很不错，而当遇到pop(0)和insert(0, v)这样既改变了列表的长度又改变其元素位置的操作时，其复杂度就变为O(n)了。</p>
<p>来看看相关的比较结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">num = <span class="number">100000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        c.append(i)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">appendleft</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, deque):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">            c.appendleft(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">            c.insert(<span class="number">0</span>, i)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        c.pop()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">popleft</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, deque):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">            c.popleft()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">            c.pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> container <span class="keyword">in</span> [deque, list]:</span><br><span class="line">    <span class="keyword">for</span> operation <span class="keyword">in</span> [append, appendleft, pop, popleft]:</span><br><span class="line">        c = container(range(num))</span><br><span class="line">        start = time.time()</span><br><span class="line">        operation(c)</span><br><span class="line">        elapsed = time.time() - start</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Completed &#123;0&#125;/&#123;1&#125; in &#123;2&#125; seconds: &#123;3&#125; ops/sec"</span>.format(</span><br><span class="line">              container.__name__, operation.__name__, elapsed, num / elapsed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Completed deque/append in 0.0250000953674 seconds: 3999984.74127 ops/sec</span></span><br><span class="line"><span class="comment"># Completed deque/appendleft in 0.0199999809265 seconds: 5000004.76838 ops/sec</span></span><br><span class="line"><span class="comment"># Completed deque/pop in 0.0209999084473 seconds: 4761925.52225 ops/sec</span></span><br><span class="line"><span class="comment"># Completed deque/popleft in 0.0199999809265 seconds: 5000004.76838 ops/sec</span></span><br><span class="line"><span class="comment"># Completed list/append in 0.0220000743866 seconds: 4545439.17637 ops/sec</span></span><br><span class="line"><span class="comment"># Completed list/appendleft in 21.3209998608 seconds: 4690.21155917 ops/sec</span></span><br><span class="line"><span class="comment"># Completed list/pop in 0.0240001678467 seconds: 4166637.52682 ops/sec</span></span><br><span class="line"><span class="comment"># Completed list/popleft in 4.01799988747 seconds: 24888.0046791 ops/sec</span></span><br></pre></td></tr></table></figure>

<p>另一个例子是执行基本的队列操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">q = deque(range(<span class="number">5</span>))</span><br><span class="line">q.append(<span class="number">5</span>)</span><br><span class="line">q.appendleft(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">print</span> q</span><br><span class="line"><span class="keyword">print</span> q.pop()</span><br><span class="line"><span class="keyword">print</span> q.popleft()</span><br><span class="line"><span class="keyword">print</span> q.rotate(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> q</span><br><span class="line"><span class="keyword">print</span> q.rotate(<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">print</span> q</span><br><span class="line"></span><br><span class="line"><span class="comment"># deque([6, 0, 1, 2, 3, 4, 5])</span></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"><span class="comment"># deque([2, 3, 4, 0, 1])</span></span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"><span class="comment"># deque([3, 4, 0, 1, 2])</span></span><br></pre></td></tr></table></figure>

<p><strong>译者注:rotate是队列的旋转操作，Right rotate(正参数)是将右端的元素移动到左端，而Left rotate(负参数)则相反。</strong></p>
<h4 id="1-3-Defaultdict"><a href="#1-3-Defaultdict" class="headerlink" title="1.3 Defaultdict"></a>1.3 Defaultdict</h4><p>这个类型除了在处理不存在的键的操作之外与普通的字典完全相同。当查找一个不存在的键操作发生时，它的default_factory会被调用，提供一个默认的值，并且将这对键值存储下来。其他的参数同普通的字典方法dict()一致，一个defaultdict的实例同内建dict一样拥有同样地操作。</p>
<p>defaultdict对象在当你希望使用它存放追踪数据的时候很有用。举个例子，假定你希望追踪一个单词在字符串中的位置，那么你可以这么做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">s = <span class="string">"the quick brown fox jumps over the lazy dog"</span></span><br><span class="line"></span><br><span class="line">words = s.split()</span><br><span class="line">location = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> m, n <span class="keyword">in</span> enumerate(words):</span><br><span class="line">    location[n].append(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> location</span><br><span class="line"></span><br><span class="line"><span class="comment"># defaultdict(&lt;type 'list'&gt;, &#123;'brown': [2], 'lazy': [7], 'over': [5], 'fox': [3],</span></span><br><span class="line"><span class="comment"># 'dog': [8], 'quick': [1], 'the': [0, 6], 'jumps': [4]&#125;)</span></span><br></pre></td></tr></table></figure>

<p>是选择lists或sets与defaultdict搭配取决于你的目的，使用list能够保存你插入元素的顺序，而使用set则不关心元素插入顺序，它会帮助消除重复元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">s = <span class="string">"the quick brown fox jumps over the lazy dog"</span></span><br><span class="line"></span><br><span class="line">words = s.split()</span><br><span class="line">location = defaultdict(set)</span><br><span class="line"><span class="keyword">for</span> m, n <span class="keyword">in</span> enumerate(words):</span><br><span class="line">    location[n].add(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> location</span><br><span class="line"></span><br><span class="line"><span class="comment"># defaultdict(&lt;type 'set'&gt;, &#123;'brown': set([2]), 'lazy': set([7]), </span></span><br><span class="line"><span class="comment"># 'over': set([5]), 'fox': set([3]), 'dog': set([8]), 'quick': set([1]), </span></span><br><span class="line"><span class="comment"># 'the': set([0, 6]), 'jumps': set([4])&#125;)</span></span><br></pre></td></tr></table></figure>

<p>另一种创建multidict的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"the quick brown fox jumps over the lazy dog"</span></span><br><span class="line">d = &#123;&#125;</span><br><span class="line">words = s.split()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> enumerate(words):</span><br><span class="line">    d.setdefault(key, []).append(value)</span><br><span class="line"><span class="keyword">print</span> d</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;0: ['the'], 1: ['quick'], 2: ['brown'], 3: ['fox'], 4: ['jumps'], 5: ['over'], 6: ['the'], 7: ['lazy'], 8: ['dog']&#125;</span></span><br></pre></td></tr></table></figure>

<p>一个更复杂的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> dict.__getitem__(self, item)</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            value = self[item] = type(self)()</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">a = Example()</span><br><span class="line"></span><br><span class="line">a[<span class="number">1</span>][<span class="number">2</span>][<span class="number">3</span>] = <span class="number">4</span></span><br><span class="line">a[<span class="number">1</span>][<span class="number">3</span>][<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">a[<span class="number">1</span>][<span class="number">2</span>][<span class="string">'test'</span>] = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># &#123;1: &#123;2: &#123;'test': 6, 3: 4&#125;, 3: &#123;3: 5&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Array"><a href="#2-Array" class="headerlink" title="2. Array"></a>2. Array</h3><p>array模块定义了一个很像list的新对象类型，不同之处在于它限定了这个类型只能装一种类型的元素。array元素的类型是在创建并使用的时候确定的。</p>
<p>如果你的程序需要优化内存的使用，并且你确定你希望在list中存储的数据都是同样类型的，那么使用array模块很合适。举个例子，如果需要存储一千万个整数，如果用list，那么你至少需要160MB的存储空间，然而如果使用array，你只需要40MB。但虽然说能够节省空间，array上几乎没有什么基本操作能够比在list上更快。</p>
<p>在使用array进行计算的时候，需要特别注意那些创建list的操作。例如，使用列表推导式(list comprehension)的时候，会将array整个转换为list，使得存储空间膨胀。一个可行的替代方案是使用生成器表达式创建新的array。看代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line"></span><br><span class="line">a = array.array(<span class="string">"i"</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">b = array.array(a.typecode, (<span class="number">2</span>*x <span class="keyword">for</span> x <span class="keyword">in</span> a))</span><br></pre></td></tr></table></figure>

<p>因为使用array是为了节省空间，所以更倾向于使用in-place操作。一种更高效的方法是使用enumerate：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line"></span><br><span class="line">a = array.array(<span class="string">"i"</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(a):</span><br><span class="line">    a[i] = <span class="number">2</span>*x</span><br></pre></td></tr></table></figure>

<p>对于较大的array，这种in-place修改能够比用生成器创建一个新的array至少提升15%的速度。</p>
<p>那么什么时候使用array呢？是当你在考虑计算的因素之外，还需要得到一个像C语言里一样统一元素类型的数组时。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> timeit <span class="keyword">import</span> Timer</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">arraytest</span><span class="params">()</span>:</span></span><br><span class="line">    a = array.array(<span class="string">"i"</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">    b = array.array(a.typecode, (<span class="number">2</span> * x <span class="keyword">for</span> x <span class="keyword">in</span> a))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enumeratetest</span><span class="params">()</span>:</span></span><br><span class="line">    a = array.array(<span class="string">"i"</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">    <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(a):</span><br><span class="line">        a[i] = <span class="number">2</span> * x</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    m = Timer(<span class="string">"arraytest()"</span>, <span class="string">"from __main__ import arraytest"</span>)</span><br><span class="line">    n = Timer(<span class="string">"enumeratetest()"</span>, <span class="string">"from __main__ import enumeratetest"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> m.timeit() <span class="comment"># 5.22479210582</span></span><br><span class="line">    <span class="keyword">print</span> n.timeit() <span class="comment"># 4.34367196717</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Heapq"><a href="#3-Heapq" class="headerlink" title="3. Heapq"></a>3. Heapq</h3><p>heapq模块使用一个用堆实现的优先级队列。堆是一种简单的有序列表，并且置入了堆的相关规则。</p>
<p>堆是一种树形的数据结构，树上的子节点与父节点之间存在顺序关系。二叉堆(binary heap)能够用一个经过组织的列表或数组结构来标识，在这种结构中，元素N的子节点的序号为2<em>N+1和2</em>N+2(下标始于0)。简单来说，这个模块中的所有函数都假设序列是有序的，所以序列中的第一个元素(seq[0])是最小的，序列的其他部分构成一个二叉树，并且seq[i]节点的子节点分别为seq[2<em>i+1]以及seq[2</em>i+2]。当对序列进行修改时，相关函数总是确保子节点大于等于父节点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">heap = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> [<span class="number">20</span>, <span class="number">10</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">40</span>]:</span><br><span class="line">    heapq.heappush(heap, value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> heap:</span><br><span class="line">    <span class="keyword">print</span> heapq.heappop(heap)</span><br></pre></td></tr></table></figure>

<p>heapq模块有两个函数nlargest()和nsmallest()，顾名思义，让我们来看看它们的用法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">-4</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">37</span>, <span class="number">2</span>]</span><br><span class="line">print(heapq.nlargest(<span class="number">3</span>, nums)) <span class="comment"># Prints [42, 37, 23]</span></span><br><span class="line">print(heapq.nsmallest(<span class="number">3</span>, nums)) <span class="comment"># Prints [-4, 1, 2]</span></span><br></pre></td></tr></table></figure>

<p>两个函数也能够通过一个键参数使用更为复杂的数据结构，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">portfolio = [</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'IBM'</span>, <span class="string">'shares'</span>: <span class="number">100</span>, <span class="string">'price'</span>: <span class="number">91.1</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'AAPL'</span>, <span class="string">'shares'</span>: <span class="number">50</span>, <span class="string">'price'</span>: <span class="number">543.22</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'FB'</span>, <span class="string">'shares'</span>: <span class="number">200</span>, <span class="string">'price'</span>: <span class="number">21.09</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'HPQ'</span>, <span class="string">'shares'</span>: <span class="number">35</span>, <span class="string">'price'</span>: <span class="number">31.75</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'YHOO'</span>, <span class="string">'shares'</span>: <span class="number">45</span>, <span class="string">'price'</span>: <span class="number">16.35</span>&#125;,</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'ACME'</span>, <span class="string">'shares'</span>: <span class="number">75</span>, <span class="string">'price'</span>: <span class="number">115.65</span>&#125;</span><br><span class="line">]</span><br><span class="line">cheap = heapq.nsmallest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> s: s[<span class="string">'price'</span>])</span><br><span class="line">expensive = heapq.nlargest(<span class="number">3</span>, portfolio, key=<span class="keyword">lambda</span> s: s[<span class="string">'price'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> cheap</span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#123;'price': 16.35, 'name': 'YHOO', 'shares': 45&#125;,</span></span><br><span class="line"><span class="comment"># &#123;'price': 21.09, 'name': 'FB', 'shares': 200&#125;, &#123;'price': 31.75, 'name': 'HPQ', 'shares': 35&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> expensive</span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#123;'price': 543.22, 'name': 'AAPL', 'shares': 50&#125;, &#123;'price': 115.65, 'name': 'ACME', </span></span><br><span class="line"><span class="comment"># 'shares': 75&#125;, &#123;'price': 91.1, 'name': 'IBM', 'shares': 100&#125;]</span></span><br></pre></td></tr></table></figure>

<p>来看看如何实现一个根据给定优先级进行排序，并且每次pop操作都返回优先级最高的元素的队列例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Item(&#123;!r&#125;)'</span>.format(self.name)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._queue = []</span><br><span class="line">        self._index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, item, priority)</span>:</span></span><br><span class="line">        heapq.heappush(self._queue, (-priority, self._index, item))</span><br><span class="line">        self._index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> heapq.heappop(self._queue)[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">q = PriorityQueue()</span><br><span class="line">q.push(Item(<span class="string">'foo'</span>), <span class="number">1</span>)</span><br><span class="line">q.push(Item(<span class="string">'bar'</span>), <span class="number">5</span>)</span><br><span class="line">q.push(Item(<span class="string">'spam'</span>), <span class="number">4</span>)</span><br><span class="line">q.push(Item(<span class="string">'grok'</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> q.pop() <span class="comment"># Item('bar')</span></span><br><span class="line"><span class="keyword">print</span> q.pop() <span class="comment"># Item('spam')</span></span><br><span class="line"><span class="keyword">print</span> q.pop() <span class="comment"># Item('foo')</span></span><br><span class="line"><span class="keyword">print</span> q.pop() <span class="comment"># Item('grok')</span></span><br></pre></td></tr></table></figure>

<h3 id="4-Bisect"><a href="#4-Bisect" class="headerlink" title="4. Bisect"></a>4. Bisect</h3><p>bisect模块能够提供保持list元素序列的支持。它使用了二分法完成大部分的工作。它在向一个list插入元素的同时维持list是有序的。在某些情况下，这比重复的对一个list进行排序更为高效，并且对于一个较大的list来说，对每步操作维持其有序也比对其排序要高效。</p>
<p>假设你有一个range集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = [(<span class="number">0</span>, <span class="number">100</span>), (<span class="number">150</span>, <span class="number">220</span>), (<span class="number">500</span>, <span class="number">1000</span>)]</span><br></pre></td></tr></table></figure>

<p>如果我想添加一个range (250, 400)，我可能会这么做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"></span><br><span class="line">a = [(<span class="number">0</span>, <span class="number">100</span>), (<span class="number">150</span>, <span class="number">220</span>), (<span class="number">500</span>, <span class="number">1000</span>)]</span><br><span class="line"></span><br><span class="line">bisect.insort_right(a, (<span class="number">250</span>,<span class="number">400</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># [(0, 100), (150, 220), (250, 400), (500, 1000)]</span></span><br></pre></td></tr></table></figure>

<p>我们可以使用bisect()函数来寻找插入点：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"></span><br><span class="line">a = [(<span class="number">0</span>, <span class="number">100</span>), (<span class="number">150</span>, <span class="number">220</span>), (<span class="number">500</span>, <span class="number">1000</span>)]</span><br><span class="line"></span><br><span class="line">bisect.insort_right(a, (<span class="number">250</span>,<span class="number">400</span>))</span><br><span class="line">bisect.insort_right(a, (<span class="number">399</span>, <span class="number">450</span>))</span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># [(0, 100), (150, 220), (250, 400), (500, 1000)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> bisect.bisect(a, (<span class="number">550</span>, <span class="number">1200</span>)) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>

<p>bisect(sequence, item) =&gt; index 返回元素应该的插入点，但序列并不被修改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bisect</span><br><span class="line"></span><br><span class="line">a = [(<span class="number">0</span>, <span class="number">100</span>), (<span class="number">150</span>, <span class="number">220</span>), (<span class="number">500</span>, <span class="number">1000</span>)]</span><br><span class="line"></span><br><span class="line">bisect.insort_right(a, (<span class="number">250</span>,<span class="number">400</span>))</span><br><span class="line">bisect.insort_right(a, (<span class="number">399</span>, <span class="number">450</span>))</span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># [(0, 100), (150, 220), (250, 400), (500, 1000)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> bisect.bisect(a, (<span class="number">550</span>, <span class="number">1200</span>)) <span class="comment"># 5</span></span><br><span class="line">bisect.insort_right(a, (<span class="number">550</span>, <span class="number">1200</span>))</span><br><span class="line"><span class="keyword">print</span> a <span class="comment"># [(0, 100), (150, 220), (250, 400), (399, 450), (500, 1000), (550, 1200)]</span></span><br></pre></td></tr></table></figure>

<p>新元素被插入到第5的位置。</p>
<h3 id="5-Weakref"><a href="#5-Weakref" class="headerlink" title="5. Weakref"></a>5. Weakref</h3><p>weakref模块能够帮助我们创建Python引用，却不会阻止对象的销毁操作。这一节包含了weak reference的基本用法，并且引入一个代理类。</p>
<p>在开始之前，我们需要明白什么是strong reference。strong reference是一个对对象的引用次数、生命周期以及销毁时机产生影响的指针。strong reference如你所见，就是当你将一个对象赋值给一个变量的时候产生的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br></pre></td></tr></table></figure>

<p>在这种情况下，这个列表有两个strong reference，分别是a和b。在这两个引用都被释放之前，这个list不会被销毁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.obj = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'created'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'destroyed'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.obj</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">store</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        self.obj = obj</span><br><span class="line"></span><br><span class="line">a = Foo() <span class="comment"># created</span></span><br><span class="line">b = a</span><br><span class="line"><span class="keyword">del</span> a</span><br><span class="line"><span class="keyword">del</span> b <span class="comment"># destroyed</span></span><br></pre></td></tr></table></figure>

<p>Weak reference则是对对象的引用计数器不会产生影响。当一个对象存在weak reference时，并不会影响对象的撤销。这就说，如果一个对象仅剩下weak reference，那么它将会被销毁。</p>
<p>你可以使用weakref.ref函数来创建对象的weak reference。这个函数调用需要将一个strong reference作为第一个参数传给函数，并且返回一个weak reference。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> weakref</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Foo()</span><br><span class="line">created</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = weakref.ref(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br></pre></td></tr></table></figure>

<p>一个临时的strong reference可以从weak reference中创建，即是下例中的b()：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == b() </span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b().show()</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>请注意当我们删除strong reference的时候，对象将立即被销毁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> a</span><br><span class="line">destroyed</span><br></pre></td></tr></table></figure>

<p>如果试图在对象被摧毁之后通过weak reference使用对象，则会返回None：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b() <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>若是使用weakref.proxy，就能提供相对于weakref.ref更透明的可选操作。同样是使用一个strong reference作为第一个参数并且返回一个weak reference，proxy更像是一个strong reference，但当对象不存在时会抛出异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Foo()</span><br><span class="line">created</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = weakref.proxy(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.store(<span class="string">'fish'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.show()</span><br><span class="line">fish</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> a</span><br><span class="line">destroyed</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.show()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "", line 1, in ?</span><br><span class="line">ReferenceError: weakly-referenced object no longer exists</span><br></pre></td></tr></table></figure>

<h4 id="完整的例子："><a href="#完整的例子：" class="headerlink" title="完整的例子："></a>完整的例子：</h4><p>引用计数器是由Python的垃圾回收器使用的，当一个对象的应用计数器变为0，则其将会被垃圾回收器回收。</p>
<p>最好将weak reference用于开销较大的对象，或避免循环引用(虽然垃圾回收器经常干这种事情)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObject</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'my_method was called!'</span></span><br><span class="line"></span><br><span class="line">obj = MyObject()</span><br><span class="line">r = weakref.ref(obj)</span><br><span class="line"></span><br><span class="line">gc.collect()</span><br><span class="line"><span class="keyword">assert</span> r() <span class="keyword">is</span> obj <span class="comment">#r() allows you to access the object referenced: it's there.</span></span><br><span class="line"></span><br><span class="line">obj = <span class="number">1</span> <span class="comment">#Let's change what obj references to</span></span><br><span class="line">gc.collect()</span><br><span class="line"><span class="keyword">assert</span> r() <span class="keyword">is</span> <span class="literal">None</span> <span class="comment">#There is no object left: it was gc'ed.</span></span><br></pre></td></tr></table></figure>

<p>提示：只有library模块中定义的class instances、functions、methods、sets、frozen sets、files、generators、type objects和certain object types(例如sockets、arrays和regular expression patterns)支持weakref。内建函数以及大部分内建类型如lists、dictionaries、strings和numbers则不支持。</p>
<h3 id="6-Copy"><a href="#6-Copy" class="headerlink" title="6. Copy()"></a>6. Copy()</h3><p>通过shallow或deep copy语法提供复制对象的函数操作。</p>
<p>shallow和deep copying的不同之处在于对于混合型对象的操作(混合对象是包含了其他类型对象的对象，例如list或其他类实例)。</p>
<ul>
<li>对于shallow copy而言，它创建一个新的混合对象，并且将原对象中其他对象的引用插入新对象。</li>
<li>对于deep copy而言，它创建一个新的对象，并且递归地复制源对象中的其他对象并插入新的对象中。</li>
</ul>
<p>普通的赋值操作知识简单的将心变量指向源对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b = [<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">c = [a,b]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normal Assignment</span></span><br><span class="line">d = c</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> id(c) == id(d)          <span class="comment"># True - d is the same object as c</span></span><br><span class="line"><span class="keyword">print</span> id(c[<span class="number">0</span>]) == id(d[<span class="number">0</span>])    <span class="comment"># True - d[0] is the same object as c[0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Shallow Copy</span></span><br><span class="line">d = copy.copy(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> id(c) == id(d)          <span class="comment"># False - d is now a new object</span></span><br><span class="line"><span class="keyword">print</span> id(c[<span class="number">0</span>]) == id(d[<span class="number">0</span>])    <span class="comment"># True - d[0] is the same object as c[0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deep Copy</span></span><br><span class="line">d = copy.deepcopy(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> id(c) == id(d)          <span class="comment"># False - d is now a new object</span></span><br><span class="line"><span class="keyword">print</span> id(c[<span class="number">0</span>]) == id(d[<span class="number">0</span>])    <span class="comment"># False - d[0] is now a new object</span></span><br></pre></td></tr></table></figure>

<p>shallow copy (copy())操作创建一个新的容器，其包含的引用指向原对象中的对象。</p>
<p>deep copy (deepcopy())创建的对象包含的引用指向复制出来的新对象。</p>
<h4 id="复杂的例子："><a href="#复杂的例子：" class="headerlink" title="复杂的例子："></a>复杂的例子：</h4><p>假定我有两个类，名为Manager和Graph，每个Graph包含了一个指向其manager的引用，而每个Manager有一个指向其管理的Graph的集合，现在我们有两个任务需要完成：</p>
<p>1) 复制一个graph实例，使用deepcopy，但其manager指向为原graph的manager。</p>
<p>2) 复制一个manager，完全创建新manager，但拷贝原有的所有graph。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> weakref, copy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, manager=None)</span>:</span></span><br><span class="line">        self.manager = <span class="literal">None</span> <span class="keyword">if</span> manager <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> weakref.ref(manager)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__deepcopy__</span><span class="params">(self, memodict)</span>:</span></span><br><span class="line">        manager = self.manager()</span><br><span class="line">        <span class="keyword">return</span> Graph(memodict.get(id(manager), manager))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, graphs=[])</span>:</span></span><br><span class="line">        self.graphs = graphs</span><br><span class="line">        <span class="keyword">for</span> g <span class="keyword">in</span> self.graphs:</span><br><span class="line">            g.manager = weakref.ref(self)</span><br><span class="line"></span><br><span class="line">a = Manager([Graph(), Graph()])</span><br><span class="line">b = copy.deepcopy(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [g.manager() <span class="keyword">is</span> b <span class="keyword">for</span> g <span class="keyword">in</span> b.graphs]:</span><br><span class="line">    <span class="keyword">print</span> <span class="literal">True</span> <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> copy.deepcopy(a.graphs[<span class="number">0</span>]).manager() <span class="keyword">is</span> a:</span><br><span class="line">    <span class="keyword">print</span> <span class="literal">True</span> <span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<h3 id="7-Pprint"><a href="#7-Pprint" class="headerlink" title="7. Pprint()"></a>7. Pprint()</h3><p>Pprint模块能够提供比较优雅的数据结构打印方式，如果你需要打印一个结构较为复杂，层次较深的字典或是JSON对象时，使用Pprint能够提供较好的打印结果。</p>
<p>假定你需要打印一个矩阵，当使用普通的print时，你只能打印出普通的列表，不过如果使用pprint，你就能打出漂亮的矩阵结构</p>
<p>如果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">matrix = [ [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>] ]</span><br><span class="line">a = pprint.PrettyPrinter(width=<span class="number">20</span>)</span><br><span class="line">a.pprint(matrix)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [[1, 2, 3],</span></span><br><span class="line"><span class="comment">#  [4, 5, 6],</span></span><br><span class="line"><span class="comment">#  [7, 8, 9]]</span></span><br></pre></td></tr></table></figure>

<h4 id="额外的知识"><a href="#额外的知识" class="headerlink" title="额外的知识"></a>额外的知识</h4><p>一些基本的数据结构</p>
<h4 id="1-单链链表"><a href="#1-单链链表" class="headerlink" title="1. 单链链表"></a>1. 单链链表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.data = <span class="literal">None</span></span><br><span class="line">        self.nextNode = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_and_return_Next</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.nextNode = Node()</span><br><span class="line">        <span class="keyword">return</span> self.nextNode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getNext</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.nextNode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setData</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        self.data = d</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildList</span><span class="params">(self, array)</span>:</span></span><br><span class="line">        self.head = Node()</span><br><span class="line">        self.head.setData(array[<span class="number">0</span>])</span><br><span class="line">        self.temp = self.head</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> array[<span class="number">1</span>:]:</span><br><span class="line">            self.temp = self.temp.set_and_return_Next()</span><br><span class="line">            self.temp.setData(i)</span><br><span class="line">            self.tail = self.temp</span><br><span class="line">        <span class="keyword">return</span> self.head</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printList</span><span class="params">(self)</span>:</span></span><br><span class="line">        tempNode = self.head</span><br><span class="line">        <span class="keyword">while</span>(tempNode!=self.tail):</span><br><span class="line">            print(tempNode.getData())</span><br><span class="line">            tempNode = tempNode.getNext()</span><br><span class="line">        print(self.tail.getData())</span><br><span class="line">myArray = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">21</span>]</span><br><span class="line"></span><br><span class="line">myList = LinkedList()</span><br><span class="line">myList.buildList(myArray)</span><br><span class="line">myList.printList()</span><br></pre></td></tr></table></figure>

<h4 id="2-用Python实现的普林姆算法"><a href="#2-用Python实现的普林姆算法" class="headerlink" title="2. 用Python实现的普林姆算法"></a>2. 用Python实现的普林姆算法</h4><p><strong>译者注：普林姆算法(Prims Algorithm)是图论中，在加权连通图中搜索最小生成树的算法。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> heapify, heappop, heappush</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prim</span><span class="params">( nodes, edges )</span>:</span></span><br><span class="line">    conn = defaultdict( list )</span><br><span class="line">    <span class="keyword">for</span> n1,n2,c <span class="keyword">in</span> edges:</span><br><span class="line">        conn[ n1 ].append( (c, n1, n2) )</span><br><span class="line">        conn[ n2 ].append( (c, n2, n1) )</span><br><span class="line"></span><br><span class="line">    mst = []</span><br><span class="line">    used = set( nodes[ <span class="number">0</span> ] )</span><br><span class="line">    usable_edges = conn[ nodes[<span class="number">0</span>] ][:]</span><br><span class="line">    heapify( usable_edges )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> usable_edges:</span><br><span class="line">        cost, n1, n2 = heappop( usable_edges )</span><br><span class="line">        <span class="keyword">if</span> n2 <span class="keyword">not</span> <span class="keyword">in</span> used:</span><br><span class="line">            used.add( n2 )</span><br><span class="line">            mst.append( ( n1, n2, cost ) )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> e <span class="keyword">in</span> conn[ n2 ]:</span><br><span class="line">                <span class="keyword">if</span> e[ <span class="number">2</span> ] <span class="keyword">not</span> <span class="keyword">in</span> used:</span><br><span class="line">                    heappush( usable_edges, e )</span><br><span class="line">    <span class="keyword">return</span> mst</span><br><span class="line"></span><br><span class="line"><span class="comment">#test</span></span><br><span class="line">nodes = list(<span class="string">"ABCDEFG"</span>)</span><br><span class="line">edges = [ (<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="number">7</span>), (<span class="string">"A"</span>, <span class="string">"D"</span>, <span class="number">5</span>),</span><br><span class="line">          (<span class="string">"B"</span>, <span class="string">"C"</span>, <span class="number">8</span>), (<span class="string">"B"</span>, <span class="string">"D"</span>, <span class="number">9</span>), (<span class="string">"B"</span>, <span class="string">"E"</span>, <span class="number">7</span>),</span><br><span class="line">      (<span class="string">"C"</span>, <span class="string">"E"</span>, <span class="number">5</span>),</span><br><span class="line">      (<span class="string">"D"</span>, <span class="string">"E"</span>, <span class="number">15</span>), (<span class="string">"D"</span>, <span class="string">"F"</span>, <span class="number">6</span>),</span><br><span class="line">      (<span class="string">"E"</span>, <span class="string">"F"</span>, <span class="number">8</span>), (<span class="string">"E"</span>, <span class="string">"G"</span>, <span class="number">9</span>),</span><br><span class="line">      (<span class="string">"F"</span>, <span class="string">"G"</span>, <span class="number">11</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"prim:"</span>, prim( nodes, edges )</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    司图
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://kanatsux.github.io/2019/12/01/Python%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="Python中的高级数据结构">http://kanatsux.github.io/2019/12/01/Python%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i>  python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/11/17/iptables%E8%AF%A6%E8%A7%A3%EF%BC%883%EF%BC%89%EF%BC%9Aiptables%E8%A7%84%E5%88%99%E7%AE%A1%E7%90%86/" rel="next" title="iptables详解（3）">
                <i class="fa fa-chevron-left"></i> iptables详解（3）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/12/20/Linux%E7%B3%BB%E7%BB%9F%E4%B8%8BFIFO%E7%9A%84%E9%98%BB%E5%A1%9E%E6%9C%BA%E5%88%B6/" rel="prev" title="Linux系统下FIFO的阻塞机制">
                Linux系统下FIFO的阻塞机制 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="司图" />
            
              <p class="site-author-name" itemprop="name">司图</p>
              <p class="site-description motion-element" itemprop="description">既然进来了，就喝杯茶吧！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
                
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/kanatsux" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:wowoohi@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lauyuenn.gitee.io/lauyuenn_blog/" title="傻朝夕" target="_blank">傻朝夕</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据结构"><span class="nav-number">1.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Collections"><span class="nav-number">1.1.</span> <span class="nav-text">1. Collections</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-Counter"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 Counter()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-Deque"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 Deque</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-Defaultdict"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 Defaultdict</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Array"><span class="nav-number">1.2.</span> <span class="nav-text">2. Array</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Heapq"><span class="nav-number">1.3.</span> <span class="nav-text">3. Heapq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Bisect"><span class="nav-number">1.4.</span> <span class="nav-text">4. Bisect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Weakref"><span class="nav-number">1.5.</span> <span class="nav-text">5. Weakref</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#完整的例子："><span class="nav-number">1.5.1.</span> <span class="nav-text">完整的例子：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Copy"><span class="nav-number">1.6.</span> <span class="nav-text">6. Copy()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#复杂的例子："><span class="nav-number">1.6.1.</span> <span class="nav-text">复杂的例子：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Pprint"><span class="nav-number">1.7.</span> <span class="nav-text">7. Pprint()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#额外的知识"><span class="nav-number">1.7.1.</span> <span class="nav-text">额外的知识</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-单链链表"><span class="nav-number">1.7.2.</span> <span class="nav-text">1. 单链链表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-用Python实现的普林姆算法"><span class="nav-number">1.7.3.</span> <span class="nav-text">2. 用Python实现的普林姆算法</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">司图</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">41.7k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
